# Grab the PID of olsrd.
PID=`ps ax | grep [o]lsrd | awk '{print $1}'`

# Grab a list of the configured interfaces.
INTERFACES=`ps ax | grep [o]lsrd | awk '{print $7,$8,$9}'`

# Test for presence of Internet route.  grep will return 0 if found,
# 1 if not found.
grep -q '^Hna4 {' /etc/olsrd.conf
NOTFOUND=$?
if [ ! $NOTFOUND ]; then
    # Hna4 line found.  Don't add it.
    exit 0
fi

# Kill olsrd.
kill -9 $PID
sleep 5

# Add Hna4 line.
echo "Hna4 {0.0.0.0 0.0.0.0}" >> /etc/olsrd.conf

# Set up NAT.
/usr/sbin/iptables -t nat -A POSTROUTING -o $interface -j MASQUERADE

# Restart olsrd.
olsrd -i $INTERFACES
